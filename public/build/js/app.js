let paso=1;const pasoInicial=1,pasoFinal=3,cita={id:"",nombre:"",fecha:"",hora:"",servicios:[]},server=window.location.origin;function iniciarApp(){mostrarSeccion(),tabs(),botonesPaginacion(),paginaSiguiente(),paginaAnterior(),consultarAPI(),nombreCliente(),idCliente(),seleccionarFecha(),seleccionarHora(),mostrarResumen()}function mostrarSeccion(){const e=document.querySelector(".mostrar");e&&e.classList.remove("mostrar");const t="#paso-"+paso;document.querySelector(t).classList.add("mostrar");const a=document.querySelector(".actual");a&&a.classList.remove("actual");document.querySelector(`[data-paso="${paso}"]`).classList.add("actual")}function tabs(){document.querySelectorAll(".tabs button").forEach(e=>{e.addEventListener("click",e=>{paso=parseInt(e.target.dataset.paso),mostrarSeccion(),botonesPaginacion()})})}function botonesPaginacion(){const e=document.querySelector("#boton-anterior"),t=document.querySelector("#boton-siguiente");1===paso?(e.classList.add("ocultar"),t.classList.remove("ocultar")):3==paso?(t.classList.add("ocultar"),e.classList.remove("ocultar"),mostrarResumen()):(t.classList.remove("ocultar"),e.classList.remove("ocultar"))}function paginaAnterior(){document.querySelector("#boton-anterior").addEventListener("click",()=>{paso--,paso<1&&(paso=1,mostrarSeccion(),botonesPaginacion()),mostrarSeccion(),botonesPaginacion()})}function paginaSiguiente(){document.querySelector("#boton-siguiente").addEventListener("click",()=>{paso++,paso>3&&(paso=3),mostrarSeccion(),botonesPaginacion()})}async function consultarAPI(){try{const e=server+"/api/servicios",t=await fetch(e);mostrarServicios(await t.json())}catch(e){console.log(e)}}function mostrarServicios(e){e.forEach(e=>{const{id:t,nombre:a,precio:o}=e,n=document.createElement("P");n.classList.add("nombre-servicio"),n.textContent=a;const c=document.createElement("P");c.classList.add("precio-servicio"),c.textContent="$"+o;const s=document.createElement("DIV");s.classList.add("servicio-contenedor"),s.dataset.idServicio=t,s.onclick=function(){seleccionarServicios(e)},s.appendChild(n),s.appendChild(c);document.querySelector("#servicios").appendChild(s)})}function seleccionarServicios(e){const{id:t}=e,{servicios:a}=cita,o=document.querySelector(`[data-id-servicio='${t}']`);a.some(e=>e.id===t)?(o.classList.remove("seleccionado"),cita.servicios=a.filter(e=>e.id!==t)):(o.classList.add("seleccionado"),cita.servicios=[...a,e])}function nombreCliente(){cita.nombre=document.querySelector("#nombre").value}function idCliente(){cita.id=document.querySelector("#idusuario").value}function seleccionarFecha(){document.querySelector("#fecha").addEventListener("input",(function(e){const t=new Date(e.target.value).getUTCDay();[6,0].includes(t)?(e.target.value="",mostrarAlerta("Sabados y Domingos no permitidos","error",".formulario")):cita.fecha=e.target.value}))}function seleccionarHora(){document.querySelector("#hora").addEventListener("input",(function(e){const t=e.target.value,a=t.split(":");a[0]<10||a[0]>18||!t?(e.target.value="",mostrarAlerta("Esta hora no es valida","error",".formulario"),cita.hora=""):cita.hora=e.target.value}))}function mostrarAlerta(e,t,a,o=!0){const n=document.querySelector(".alerta");n&&n.remove();const c=document.createElement("DIV");c.textContent=e,c.classList.add("alerta"),c.classList.add(t);document.querySelector(a).appendChild(c),o&&setTimeout(()=>{c.remove()},3e3)}function mostrarResumen(){const e=document.querySelector("#resumen");for(;e.firstChild;)e.removeChild(e.firstChild);if(Object.values(cita).includes("")||0===cita.servicios.length)return void mostrarAlerta("Faltan datos","error","#resumen",!1);const{nombre:t,fecha:a,hora:o,servicios:n}=cita,c=document.createElement("H3");c.textContent="Resumen de Cita",e.appendChild(c);const s=document.createElement("DIV");s.classList.add("contenedor-cita");const i=document.createElement("P");i.classList.add("nombre-cliente"),i.innerHTML="<span>Nombre: </span>"+t;const r=new Date(a),d=r.getDate()+2,l=r.getMonth(),u=r.getFullYear(),m=new Date(Date.UTC(u,l,d)).toLocaleDateString("es-MX",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),p=document.createElement("P");p.classList.add("fecha-cita"),p.innerHTML="<span>Fecha: </span>"+m;const v=document.createElement("P");v.classList.add("hora-cita"),v.innerHTML="<span>Hora: </span>"+o,s.appendChild(i),s.appendChild(p),s.appendChild(v),e.appendChild(s);const h=document.createElement("DIV");h.classList.add("listado-servicios");const C=document.createElement("H3");C.textContent="Resumen de Servicios",e.appendChild(C);let f=0;n.forEach(e=>{const{id:t,nombre:a,precio:o}=e;f+=parseFloat(o);const n=document.createElement("P");n.classList.add("nombre-servicio"),n.textContent=a;const c=document.createElement("P");c.classList.add("precio-servicio"),c.textContent="$"+o;const s=document.createElement("DIV");s.classList.add("servicio-contenedor"),s.appendChild(n),s.appendChild(c),h.appendChild(s)}),e.appendChild(h);const L=document.createElement("H3");L.textContent="Costo Estimado",L.classList.add("total-servicios"),e.appendChild(L);const g=document.createElement("DIV");g.classList.add("total-contenedor");const S=document.createElement("P");S.classList.add("total-servicios"),S.innerHTML="<span>Total: </span>$"+f,g.appendChild(S),e.appendChild(g);const b=document.createElement("BUTTON");b.classList.add("boton"),b.textContent="Reservar Cita",b.onclick=reservarCita,e.appendChild(b)}async function reservarCita(){const{id:e,nombre:t,fecha:a,hora:o,servicios:n}=cita,c=new FormData,s=n.map(e=>e.id);c.append("usuarioId",e),c.append("nombre",t),c.append("fecha",a),c.append("hora",o),c.append("servicioId",s);const i=server+"/api/servicios";try{const e=await fetch(i,{method:"POST",body:c});await e.json()?Swal.fire({icon:"success",title:"Cita creada",text:"Tu cita fue creada correctamente",button:"OK"}).then(()=>{setTimeout(()=>{window.location.reload()},1500)}):mostrarAlerta("Algo salio mal, intenta recargando la pagina","error","#resumen")}catch(e){Swal.fire("Ups... algo salio mal","Intentalo mas tarde o recarga la pagina","question")}}document.addEventListener("DOMContentLoaded",()=>{iniciarApp()});